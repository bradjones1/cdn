<?php

/**
 * Implements hook_file_url_alter().
 */
function cdn_file_url_alter(&$uri) {
  // Don't alter file URLs when running update.php.
  if (defined('MAINTENANCE_MODE')) {
    return;
  }

  // Don't alter file URLs while processing a CSS file.
  // @see \Drupal\cdn\Asset\CssOptimizer
  global $cdn_in_css_file;
  if ($cdn_in_css_file) {
    return;
  }

  $result = \Drupal::service('cdn.file_url_generator')->generate($uri);
  if ($result) {
    $uri = $result;
  }
}
